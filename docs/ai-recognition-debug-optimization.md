# Labubu AIè¯†åˆ«åŠŸèƒ½è°ƒè¯•ä¼˜åŒ–æŠ¥å‘Š

## ğŸ“Š é—®é¢˜åˆ†æ

### ğŸ” ç”¨æˆ·åé¦ˆçš„é—®é¢˜
æ ¹æ®ç”¨æˆ·æä¾›çš„æ—¥å¿—ï¼ŒAIè¯†åˆ«åŠŸèƒ½è™½ç„¶èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨å¹¶è¯»å–APIé…ç½®ï¼Œä½†æœ€ç»ˆç»“æœæ˜¾ç¤º"æœªè¯†åˆ«"ï¼š

```
ğŸ¤– å°è¯•AIè¯†åˆ«...
ğŸ¤– å¼€å§‹AIè¯†åˆ«ç”¨æˆ·æ‹æ‘„çš„Labubu...
ğŸ“ LabubuAIä» .env è¯»å–åˆ°TUZI_API_KEY
ğŸ“ LabubuAIä» .env è¯»å–åˆ°TUZI_API_BASE
âœ… AIè¯†åˆ«å®Œæˆ: æœªè¯†åˆ«
```

### ğŸ” æŠ€æœ¯åˆ†æ

#### 1. **å›¾ç‰‡ä¼ é€’æ–¹å¼ç¡®è®¤**
- âœ… **ä½¿ç”¨Base64ç¼–ç ä¸Šä¼ å›¾ç‰‡**ï¼Œè€ŒéSupabase URL
- ğŸ“ ä½ç½®ï¼š`LabubuAIRecognitionService.swift` ç¬¬143-147è¡Œ
- ğŸ“ å®ç°ï¼š`let base64Image = "data:image/jpeg;base64," + imageData.base64EncodedString()`

#### 2. **æµå¼æ¨¡å¼çŠ¶æ€ç¡®è®¤**
- âŒ **æœªå¯ç”¨æµå¼æ¨¡å¼**
- ğŸ“ æ–°å¢ï¼šæ˜ç¡®è®¾ç½® `"stream": false` ç¡®ä¿å®Œæ•´å“åº”
- ğŸ’¡ åŸå› ï¼šæµå¼æ¨¡å¼å¯èƒ½å¯¼è‡´å“åº”è§£æé—®é¢˜

#### 3. **æ½œåœ¨é—®é¢˜è¯†åˆ«**
- ğŸš¨ **ç¼ºå°‘è¯¦ç»†è°ƒè¯•æ—¥å¿—**ï¼šæ— æ³•çœ‹åˆ°APIå®é™…è°ƒç”¨è¿‡ç¨‹
- ğŸš¨ **Base64æ•°æ®å¯èƒ½è¿‡å¤§**ï¼šå½±å“ä¼ è¾“æ•ˆç‡
- ğŸš¨ **é”™è¯¯å¤„ç†ä¸å¤Ÿè¯¦ç»†**ï¼šéš¾ä»¥å®šä½å…·ä½“å¤±è´¥åŸå› 

## ğŸ› ï¸ ä¼˜åŒ–æªæ–½

### 1. **å¢å¼ºè°ƒè¯•æ—¥å¿—**
æ·»åŠ äº†å®Œæ•´çš„APIè°ƒç”¨è¿‡ç¨‹æ—¥å¿—ï¼š

```swift
print("ğŸ”‘ APIå¯†é’¥å·²è·å–: \(apiKey.prefix(10))...")
print("ğŸŒ APIåŸºç¡€URL: \(baseURL)")
print("ğŸ“· å›¾åƒæ•°æ®å¤§å°: \(imageData.count) å­—èŠ‚")
print("ğŸ“ Base64ç¼–ç å®Œæˆï¼Œé•¿åº¦: \(base64Image.count) å­—ç¬¦")
print("ğŸ“¦ è¯·æ±‚ä½“å¤§å°: \(request.httpBody?.count ?? 0) å­—èŠ‚")
print("ğŸš€ å‘é€APIè¯·æ±‚...")
print("ğŸ“¥ æ”¶åˆ°å“åº”ï¼Œæ•°æ®å¤§å°: \(data.count) å­—èŠ‚")
print("ğŸ“Š HTTPçŠ¶æ€ç : \(httpResponse.statusCode)")
```

### 2. **ä¼˜åŒ–å›¾ç‰‡å‹ç¼©é…ç½®**
å‡å°‘Base64æ•°æ®ä¼ è¾“é‡ï¼š

```swift
// ä¼˜åŒ–å‰
private let maxImageSize: CGFloat = 1024
private let compressionQuality: CGFloat = 0.8

// ä¼˜åŒ–å  
private let maxImageSize: CGFloat = 800       // é™ä½20%
private let compressionQuality: CGFloat = 0.6  // é™ä½25%
```

**é¢„æœŸæ•ˆæœ**ï¼š
- å›¾ç‰‡å°ºå¯¸å‡å°‘çº¦ 36% (800Â²/1024Â² â‰ˆ 0.64)
- æ–‡ä»¶å¤§å°è¿›ä¸€æ­¥å‡å°‘çº¦ 25%
- æ€»ä½“Base64æ•°æ®é‡å‡å°‘çº¦ 50%

### 3. **æ˜ç¡®ç¦ç”¨æµå¼æ¨¡å¼**
```swift
let requestBody = [
    "model": "gemini-2.5-flash-all",
    "stream": false,  // æ˜ç¡®ç¦ç”¨æµå¼æ¨¡å¼ï¼Œç¡®ä¿å®Œæ•´å“åº”
    // ...
]
```

### 4. **å¢å¼ºé”™è¯¯å¤„ç†**
```swift
if httpResponse.statusCode != 200 {
    let errorBody = String(data: data, encoding: .utf8) ?? "æ— æ³•è§£æé”™è¯¯ä¿¡æ¯"
    print("âŒ APIè¯·æ±‚å¤±è´¥: \(httpResponse.statusCode)")
    print("âŒ é”™è¯¯è¯¦æƒ…: \(errorBody)")
    throw LabubuAIError.networkError("APIè¯·æ±‚å¤±è´¥: \(httpResponse.statusCode) - \(errorBody)")
}
```

## ğŸ“ˆ é¢„æœŸæ”¹è¿›æ•ˆæœ

### 1. **è°ƒè¯•èƒ½åŠ›æå‡**
- âœ… å®Œæ•´çš„APIè°ƒç”¨é“¾è·¯æ—¥å¿—
- âœ… è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯è¾“å‡º
- âœ… æ•°æ®å¤§å°å’Œä¼ è¾“çŠ¶æ€ç›‘æ§

### 2. **æ€§èƒ½ä¼˜åŒ–**
- ğŸš€ Base64æ•°æ®é‡å‡å°‘çº¦50%
- ğŸš€ ç½‘ç»œä¼ è¾“æ—¶é—´ç¼©çŸ­
- ğŸš€ APIå“åº”é€Ÿåº¦æå‡

### 3. **ç¨³å®šæ€§å¢å¼º**
- ğŸ›¡ï¸ æ˜ç¡®çš„æµå¼æ¨¡å¼æ§åˆ¶
- ğŸ›¡ï¸ è¯¦ç»†çš„é”™è¯¯å¤„ç†æœºåˆ¶
- ğŸ›¡ï¸ æ›´å¥½çš„å¼‚å¸¸å®šä½èƒ½åŠ›

## ğŸ” ä¸‹æ¬¡æµ‹è¯•æ—¶çš„é¢„æœŸæ—¥å¿—

ä¼˜åŒ–åï¼Œç”¨æˆ·åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„è¯¦ç»†æ—¥å¿—ï¼š

```
ğŸ¤– å°è¯•AIè¯†åˆ«...
ğŸ¤– å¼€å§‹AIè¯†åˆ«ç”¨æˆ·æ‹æ‘„çš„Labubu...
ğŸ“ LabubuAIä» /path/.env è¯»å–åˆ°TUZI_API_KEY
ğŸ“ LabubuAIä» /path/.env è¯»å–åˆ°TUZI_API_BASE
ğŸ”‘ APIå¯†é’¥å·²è·å–: sk-1234567...
ğŸŒ APIåŸºç¡€URL: https://api.tu-zi.com/v1
ğŸ“· å›¾åƒæ•°æ®å¤§å°: 45678 å­—èŠ‚
ğŸ“· å‹ç¼©è´¨é‡: 0.6
ğŸ“ Base64ç¼–ç å®Œæˆï¼Œé•¿åº¦: 61234 å­—ç¬¦
ğŸŒ è¯·æ±‚URL: https://api.tu-zi.com/v1/chat/completions
â±ï¸ è¶…æ—¶è®¾ç½®: 120.0 ç§’
ğŸ“¦ è¯·æ±‚ä½“å¤§å°: 62000 å­—èŠ‚
ğŸš€ å‘é€APIè¯·æ±‚...
ğŸ“¥ æ”¶åˆ°å“åº”ï¼Œæ•°æ®å¤§å°: 1234 å­—èŠ‚
ğŸ“Š HTTPçŠ¶æ€ç : 200
âœ… JSONå“åº”è§£ææˆåŠŸ
ğŸ“ AIåˆ†æå†…å®¹é•¿åº¦: 800 å­—ç¬¦
ğŸ“ AIåˆ†æå†…å®¹é¢„è§ˆ: {"isLabubu": true, "confidence": 0.85...
âœ… AIåˆ†æç»“æœè§£æå®Œæˆ
ğŸ¯ è¯†åˆ«ç»“æœ: isLabubu=true, confidence=0.85
âœ… AIè¯†åˆ«å®Œæˆ: Classic Pink Labubu
```

## ğŸš¨ æ•…éšœæ’é™¤æŒ‡å—

å¦‚æœä¼˜åŒ–åä»ç„¶å‡ºç°"æœªè¯†åˆ«"é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **APIå¯†é’¥æœ‰æ•ˆæ€§**ï¼šç¡®è®¤TUZI_API_KEYæ˜¯å¦æ­£ç¡®ä¸”æœ‰æ•ˆ
2. **ç½‘ç»œè¿æ¥**ï¼šæ£€æŸ¥æ˜¯å¦èƒ½æ­£å¸¸è®¿é—® https://api.tu-zi.com
3. **å›¾ç‰‡è´¨é‡**ï¼šç¡®è®¤æ‹æ‘„çš„å›¾ç‰‡æ¸…æ™°ä¸”åŒ…å«Labubu
4. **APIé…é¢**ï¼šæ£€æŸ¥APIè°ƒç”¨æ¬¡æ•°æ˜¯å¦è¶…é™
5. **æ¨¡å‹å¯ç”¨æ€§**ï¼šç¡®è®¤gemini-2.5-flash-allæ¨¡å‹æ˜¯å¦å¯ç”¨

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### Base64ç¼–ç æ–¹å¼
```swift
// å›¾ç‰‡ -> JPEGæ•°æ® -> Base64ç¼–ç  -> Data URLæ ¼å¼
let imageData = image.jpegData(compressionQuality: 0.6)
let base64Image = "data:image/jpeg;base64," + imageData.base64EncodedString()
```

### APIè¯·æ±‚æ ¼å¼
```json
{
  "model": "gemini-2.5-flash-all",
  "stream": false,
  "messages": [
    {
      "role": "user", 
      "content": [
        {"type": "text", "text": "è¯†åˆ«æç¤ºè¯"},
        {"type": "image_url", "image_url": {"url": "data:image/jpeg;base64,..."}}
      ]
    }
  ]
}
```

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´**ï¼š2024å¹´12æœˆ24æ—¥  
**ä¼˜åŒ–ç‰ˆæœ¬**ï¼šv1.1 - å¢å¼ºè°ƒè¯•ä¸æ€§èƒ½ä¼˜åŒ–  
**ä¸‹æ¬¡æ›´æ–°**ï¼šæ ¹æ®ç”¨æˆ·æµ‹è¯•åé¦ˆè¿›ä¸€æ­¥ä¼˜åŒ– 