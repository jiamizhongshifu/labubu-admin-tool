# 全屏图片预览功能实现

## 功能概述
在图片详情页添加了全屏预览模式，用户可以通过点击图片或"查看大图"按钮进入全屏预览，在预览模式中进行图片保存操作。

## 主要改动

### 1. 新增 FullScreenImageView.swift
- **位置**: `jitata/Views/Components/FullScreenImageView.swift`
- **功能**: 
  - 全屏图片预览，支持缩放（1x-5x）和平移
  - 双击缩放/重置功能
  - 图片切换功能（原图/增强图）
  - 保存到相册功能（智能选择保存按钮）
  - 手势操作：捏合缩放、拖拽平移、点击背景关闭

### 2. 修改 StickerDetailView.swift
- **移除**: 原有的保存按钮和相关状态变量
- **新增**: "查看大图"按钮和全屏预览入口
- **修改**: LargeImageView 组件支持点击查看大图

### 3. 用户体验优化
- **图片预览**: 
  - 黑色背景，隐藏状态栏
  - 顶部显示图片信息和切换按钮
  - 底部显示缩放比例和保存按钮
  - 点击背景或关闭按钮退出预览

- **保存功能**:
  - 有增强图时：显示"保存原图"和"保存增强版"两个按钮
  - 无增强图时：显示单个"保存到相册"按钮
  - 保存过程中显示进度指示器
  - 保存成功后显示详细信息（尺寸、文件大小）

## 技术特性

### 手势支持
- **缩放**: 1x-5x 范围内的平滑缩放
- **平移**: 放大状态下支持拖拽查看图片细节
- **双击**: 在1x和2x之间切换
- **边界限制**: 防止图片拖拽超出合理范围

### 图片质量保证
- **原图保存**: 使用高质量PNG格式，保持透明背景
- **增强图保存**: 直接保存API返回的高分辨率数据
- **方向校正**: 自动处理图片方向问题

### 状态管理
- **缩放状态**: 实时显示当前缩放比例
- **保存状态**: 防止重复保存操作
- **图片切换**: 平滑的动画过渡

## 使用流程

1. **进入预览**: 
   - 点击详情页中的图片
   - 点击"查看大图"按钮

2. **预览操作**:
   - 双击或捏合手势缩放图片
   - 拖拽查看图片细节
   - 点击右上角按钮切换原图/增强图（如有）

3. **保存图片**:
   - 点击底部保存按钮
   - 选择保存原图或增强版（如有选择）
   - 查看保存结果提示

4. **退出预览**:
   - 点击左上角关闭按钮
   - 点击背景空白区域

## 代码结构

```
FullScreenImageView
├── 状态变量
│   ├── scale: 缩放比例
│   ├── offset: 平移偏移
│   ├── isSavingToPhotoLibrary: 保存状态
│   └── showingSaveAlert: 提示弹窗
├── UI组件
│   ├── 黑色背景层
│   ├── 图片显示区域（支持手势）
│   ├── 顶部工具栏（关闭、信息、切换）
│   └── 底部工具栏（缩放提示、保存按钮）
└── 功能方法
    ├── saveImageToPhotoLibrary: 保存图片
    ├── 手势处理逻辑
    └── 状态管理逻辑
```

## 兼容性
- **iOS版本**: 支持iOS 14.0+
- **设备**: iPhone、iPad全系列
- **方向**: 支持竖屏和横屏
- **权限**: 自动处理相册访问权限

## 性能优化
- **内存管理**: 使用弱引用避免循环引用
- **图片处理**: 避免重复压缩，保持原始质量
- **动画性能**: 使用硬件加速的Core Animation
- **手势响应**: 优化手势识别性能

这个实现提供了完整的全屏图片预览体验，将保存功能集成到预览模式中，简化了详情页的界面，提升了用户体验。 